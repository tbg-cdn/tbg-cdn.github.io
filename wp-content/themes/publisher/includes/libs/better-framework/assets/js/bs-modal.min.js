/***
 *  BetterFramework is BetterStudio framework for themes and plugins.
 *
 *  ______      _   _             ______                                           _
 *  | ___ \    | | | |            |  ___|                                         | |
 *  | |_/ / ___| |_| |_ ___ _ __  | |_ _ __ __ _ _ __ ___   _____      _____  _ __| | __
 *  | ___ \/ _ \ __| __/ _ \ '__| |  _| '__/ _` | '_ ` _ \ / _ \ \ /\ / / _ \| '__| |/ /
 *  | |_/ /  __/ |_| ||  __/ |    | | | | | (_| | | | | | |  __/\ V  V / (_) | |  |   <
 *  \____/ \___|\__|\__\___|_|    \_| |_|  \__,_|_| |_| |_|\___| \_/\_/ \___/|_|  |_|\_\
 *
 *  Copyright Â© 2017 Better Studio
 *
 *
 *  Our portfolio is here: http://themeforest.net/user/Better-Studio/portfolio
 *
 *  \--> BetterStudio, 2017 <--/
 */


!function(t){"use strict";var s=0,n=[],e=function(s){function n(){return!0}this.options=t.extend(!0,{template:"default",skin:"skin-1",show:!0,content:{},close_button:!0,button_position:"right",animations:{delay:600,open:"bs-animate bs-fadeInDown",close:"bs-animate bs-fadeOutUp"},buttons:{},events:{before_click:n,clicked:n,handle_keyup:function(t,s,n){return n}},styles:{modal:"",container:""},modalId:"modal-"+Math.floor(999*Math.random()),modalClass:"",destroyHtml:!0,is_vertical_center:!0},s),this.$modal=!1,this.$overlay=!1,this.timerTimeouts=[],this.$document=!1,this.modalID=!1,this.visible=!1,this.init()};e.prototype={templates:{"default":'\n<div class="bs-modal-default"  {{#inline_style}} style="{{inline_style}}" {{/inline_style}}>\n    {{#close_button}}\n    <a href="#" class="bs-close-modal">\n        <i class="fa fa-times" aria-hidden="true"></i>\n    </a>\n    {{/close_button}}\n    <div class="bs-modal-header-wrapper bs-modal-clearfix">\n        <h2 class="bs-modal-header">\n            {{#icon}}\n            <i class="fa {{icon}}"></i>\n            {{/icon}}\n\n            {{header}}\n        </h2>\n    </div>\n\n    <div class="bs-modal-body">\n        {{{bs_body}}}\n    </div>\n\n    {{#bs_buttons}}\n    <div class="bs-modal-bottom bs-modal-buttons-{{btn_position}} bs-modal-clearfix">\n        {{{bs_buttons}}}\n    </div>\n    {{/bs_buttons}}\n</div>',single_image:'\n<div class="bs-modal-default" {{#inline_style}} style="{{inline_style}}" {{/inline_style}}>\n    {{#close_button}}\n    <a href="#" class="bs-close-modal">\n        <i class="fa fa-times" aria-hidden="true"></i>\n    </a>\n    {{/close_button}}\n    <div class="bs-modal-header-wrapper bs-modal-clearfix">\n        <h2 class="bs-modal-header">\n            {{#icon}}\n            <i class="fa {{icon}}"></i>\n            {{/icon}}\n\n            {{header}}\n        </h2>\n    </div>\n\n    <div class="bs-modal-body bf-clearfix">\n        \n        <div class="bs-modal-image bf-clearfix" {{#image_align}} style="float:{{image_align}}"{{/image_align}}>\n\n            <img src="{{image_src}}" {{#image_style}} style="{{image_style}}"{{/image_style}}/>\n            \n            {{#image_caption}}\n            <div class="bs-modal-image-caption">\n                {{image_caption}}\n            </div>\n            {{/image_caption}}\n        </div>\n        {{{bs_body}}}\n    </div>\n\n    {{#bs_buttons}}\n    <div class="bs-modal-bottom bs-modal-buttons-left bs-modal-clearfix">\n        {{{bs_buttons}}}\n        \n        {{#checkbox}}\n        <div class="bs-modal-checkbox">\n            <input type="checkbox" name="include_content" class="toggle-content" value="1" checked="checked"> <label class="checkbox-label">{{checkbox_label}}</label>\n        </div>\n        {{/checkbox}}\n    </div>\n    {{/bs_buttons}}\n</div>'},skins:{"skin-1":'<div class="bs-modal-description">\n    <h3 class="bs-modal-title">{{title}}</h3>\n    \n    {{{body}}}\n</div>',loading:' <div class="bs-modal-loading">\n     <div class="la-line-scale-pulse-out-rapid la-2x">\n         <div></div>\n         <div></div>\n         <div></div>\n         <div></div>\n         <div></div>\n     </div>\n     \n     <div class="bs-modal-loading-heading">\n         <h4>{{loading_heading}}</h4>\n     </div>\n</div>\n',success:' <div class="bs-modal-success">\n     \n     <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>\n     \n     <div class="bs-modal-bs-modal-success-heading">\n         <h4>{{success_heading}}</h4>\n     </div>\n</div>\n'},button_struct:'<a {{#href}}href="{{href}}"{{/href}} {{#btn_classes}}class="{{btn_classes}}"{{/btn_classes}} id="{{id}}">{{{label}}}</a>',debug:function(t){console.error(t)},get_html:function(s,n,e){if("undefined"==typeof this.templates[s])return this.debug("invalid template name"),!1;if("undefined"==typeof this.skins[n])return this.debug("invalid skin"),!1;Mustache.parse(this.templates[s]);Mustache.parse(this.skins[n]);var i=Mustache.render(this.skins[n],e),o={bs_body:i,bs_buttons:this.generate_buttons(),close_button:this.options.close_button,inline_style:this.options.styles.modal,btn_position:this.options.button_position};return Mustache.render(this.templates[s],t.extend(e,o))},before_append_html:function(t){this.handle_event("before_append_html",this,t)},after_append_html:function(t){this.options.is_vertical_center&&this.make_vertical_center(),this.handle_event("after_append_html",this,t)},after_close_modal:function(){t(window).off("resize.bs-modal"),n.pop()},has_button:function(){return"object"==typeof this.options.buttons},append_html:function(){this.before_append_html("modal");var t=this.get_html(this.options.template,this.options.skin,this.options.content);return"string"!=typeof t?t:(this.$modal.html(t),this.after_append_html("modal"),!0)},generate_buttons:function(){if(!this.has_button())return"";Mustache.parse(this.button_struct);var t="";for(var s in this.options.buttons)t+="\n",t+=Mustache.render(this.button_struct,this.get_button_replacement_object(s));return t},get_button_replacement_object:function(s){if("object"!=typeof this.options.buttons[s])return this.debug("invalid button id"),{};var n=t.extend({focus:!1},this.options.buttons[s]);return delete n.clicked,n.id=s,"string"!=typeof n.btn_classes&&(n.btn_classes=""),-1!==t.inArray(n.type,["primary","secondary"])&&(n.btn_classes+=" bs-modal-btn-"+n.type),n.focus&&(n.btn_classes+=" bs-modal-btn-focus"),n},close_modal:function(t){this.visible=!1;var s=this,t=t||"callback";s.handle_event("modal_close",this,t);for(var n=0;n<this.timerTimeouts.length;n++)clearTimeout(this.timerTimeouts[n]);s.$modal.removeClass(this.options.animations.open).addClass(this.options.animations.close).delay(this.options.animations.delay).queue(function(t){s.$modal.hide().removeClass(s.options.animations.close),s.options.destroyHtml?s.$modal.remove():s.$modal.clearQueue(),t()}),s.$overlay.fadeOut(this.options.animations.delay,function(){s.options.destroyHtml&&s.find().remove(),s.$document.removeClass("modal-open"),s.keyup_unbind(),s.handle_event("modal_closed",this,t)}),s.after_close_modal()},keyup_unbind:function(){this.options.destroyHtml&&this.$document.off("keyup.bs-modal-"+this.getModalID())},handle_event:function(t,s){var n=Array.prototype.slice.call(arguments,2);return"function"==typeof this.options.events[t]?this.options.events[t].apply(this,[s,this.options].concat(n)):void 0},handle_timer:function(t){var s=this;this.timerTimeouts.push(setTimeout(function(){t.callback.call(s,s.option)},t.delay))},change_skin:function(n,e){e="boolean"==typeof e?e:!0;var i=t.extend(e,{template:this.options.template,skin:this.options.skin,content:this.options.content,animations:{open:!1,body:!1,delay:20},buttons:{},styles:{}},n);if(this.options.buttons=i.buttons,i.styles.container){var o={inline_style:i.styles.container},a=Mustache.render('<div class="bs-modal" {{#inline_style}} style="{{inline_style}}" {{/inline_style}}></div>\n',o);this.$modal[0].outerHTML=a,this.$modal=this.find(".bs-modal").css("z-index",s+1).show(),this.afterWrapperHtmlGenerated()}var l=this.get_html(i.template,i.skin,i.content);return"string"!=typeof l?l:(this.$modal.html(l).removeClass(this.options.animations.open).delay(20).queue(function(s){i.animations.open&&t(this).addClass(i.animations.open),s()}).removeClass(function(t,s){return(s.match(/(^|\s)skin-\S+/g)||[]).join(" ")}).addClass("skin-"+i.skin).find(".bs-modal-body").addClass(i.animations.body),"object"==typeof i.timer&&this.handle_timer(i.timer),this.after_append_html("change_skin"),void this.handle_event("modal_loaded",this))},make_vertical_center:function(){var s=this;t(window).on("resize.bs-modal",function(){if(!s.isModalLast())return!1;var t=s.$modal.innerHeight(),n=window.innerHeight;if(n>t)var e=Math.ceil((n-t)/2);else var e=35;s.$modal.css("top",e)}).resize()},getModalID:function(){return this.modalID},setModalID:function(t){this.modalID=t},setActiveModalId:function(t){n.push(t)},getActiveModalId:function(){return n.length?n[n.length-1]:0},isModalLast:function(){return this.getActiveModalId()===this.getModalID()},find:function(s){var n=this.$document.find("#"+this.getModalID());return s?t(s,n):n},_fixModalZindex:function(){},show:function(){var t=this;this.$overlay.fadeIn(this.options.animations.open,function(){t.$document.addClass("modal-open")}),this.$modal.addClass(t.options.animations.open).addClass("skin-"+t.options.skin).show().delay(t.options.animations.delay).queue(function(s){"object"==typeof t.options.timer&&t.handle_timer(t.options.timer),s()}),this.setActiveModalId(this.getModalID()),this.visible=!0,this.handle_event("modal_show",this)},init:function(){this.$document=t(document.body);var n=this;this.setModalID(this.options.modalId),this.setActiveModalId(this.getModalID());var e=0===this.find().length;if(e){var i={inline_style:this.options.styles.container,modal_id:this.getModalID(),modal_class:this.options.modalClass};this.$document.append(Mustache.render('<div id="{{modal_id}}"{{#modal_class}} class="{{modal_class}}"{{/modal_class}}>\n    <div class="bs-modal-overlay"></div>\n        <div class="bs-modal" {{#inline_style}} style="{{inline_style}}" {{/inline_style}}>\n    </div>\n</div>',i))}this.$modal=this.find(".bs-modal"),this.$overlay=this.find(".bs-modal-overlay"),s?(s++,this.$overlay.css("z-index",s),this.$modal.css("z-index",s+1)):s=parseInt(this.$modal.css("z-index")),e&&n.afterWrapperHtmlGenerated(),this.options.close_button&&this.$document.on("keyup.bs-modal-"+this.getModalID(),function(s){if(!n.handle_event("handle_keyup",s,n.isModalLast()))return!1;if(n.options.close_button&&27===s.which)n.close_modal("esc");else if(13===s.which){if(n.has_button()){var e=n.$modal.find(".bs-modal-bottom"),i=t(".bs-modal-btn-focus",e);i.length||(i=t(".bs-modal-btn-primary",e)),i.trigger("click")}n.keyup_unbind()}}),this.options.show&&n.show(),e&&n.append_html(),this.handle_event("modal_loaded",this)},afterWrapperHtmlGenerated:function(){var s=this;this.$modal.on("click","a",function(n){if(s.handle_event("before_click",this)){var e=t(this),i=e.attr("id");if(e.hasClass("bs-close-modal"))n.preventDefault(),s.close_modal("btn");else if(i&&"object"==typeof s.options.buttons[i]){var o=s.options.buttons[i];switch(o.action){case"close":s.close_modal("link")}"function"==typeof o.clicked&&o.clicked.call(s)}s.handle_event("clicked",this)}})}},t.bs_modal=function(t){return new e(t)},t.bs_modal_template=function(t,s){e.prototype.templates[t]=s}}(jQuery);